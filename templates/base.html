{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Rentify{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter&display=swap" rel="stylesheet">
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />

    {% block css %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% endblock css %}
</head>
<body>
{% block nav %}
{% with request.resolver_match.url_name as url_name %}

<!-- ================= DESKTOP NAVBAR ================= -->
<nav class="navbar navbar-expand-lg fixed-top rentify-navbar">
    <div class="container">
        <a class="navbar-brand rentify-logo" href="{% url 'home' %}">
            Rentify
        </a>

        <!-- MOBILE HAMBURGER (CUSTOM, NOT BOOTSTRAP) -->
        <button class="navbar-toggler d-lg-none border-0 fs-3" onclick="openSidebar()">
            â˜°
        </button>

        <!-- DESKTOP MENU ONLY -->
        <div class="collapse navbar-collapse d-none d-lg-block">
            <ul class="navbar-nav ms-auto align-items-center">

                <li class="nav-item">
                    <a class="nav-link {% if url_name == 'home' %}active{% endif %}"
                       href="{% url 'home' %}">Home</a>
                </li>

                {% if not user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link {% if url_name == 'rent_clothes' %}active{% endif %}"
                           href="{% url 'rent_clothes' %}">Rent Clothes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if url_name == 'list_clothes' %}active{% endif %}"
                           href="{% url 'list_clothes' %}">List Clothes</a>
                    </li>
                {% elif user.is_buyer %}
                    <li class="nav-item">
                        <a class="nav-link {% if url_name == 'rent_clothes' %}active{% endif %}"
                           href="{% url 'rent_clothes' %}">Rent Clothes</a>
                    </li>
                {% elif user.is_seller %}
                    <li class="nav-item">
                        <a class="nav-link {% if url_name == 'list_clothes' %}active{% endif %}"
                           href="{% url 'list_clothes' %}">List Clothes</a>
                    </li>
                {% endif %}

                {% if user.is_authenticated %}
                    <li class="nav-item ms-3">
                        {% if user.is_buyer %}
                            <a class="nav-link {% if url_name == 'buyer_dashboard' %}active{% endif %}"
                               href="{% url 'buyer_dashboard' %}">My Account</a>
                        {% elif user.is_seller %}
                            <a class="nav-link {% if url_name == 'seller_dashboard' %}active{% endif %}"
                               href="{% url 'seller_dashboard' %}">My Account</a>
                        {% endif %}
                    </li>
                    <li class="nav-item ms-3">
                        <a class="btn rentify-btn-outline" href="{% url 'logout' %}">Logout</a>
                    </li>
                {% else %}
                    <li class="nav-item ms-3">
                        <a class="btn {% if url_name == 'login' %}rentify-btn{% else %}rentify-btn-outline{% endif %}"
                           href="{% url 'login' %}">Login</a>
                    </li>
                    <li class="nav-item ms-2">
                        <a class="btn {% if url_name == 'register' %}rentify-btn{% else %}rentify-btn-outline{% endif %}"
                           href="{% url 'register' %}">Register</a>
                    </li>
                {% endif %}

            </ul>
        </div>
    </div>
</nav>

<!-- ================= MOBILE OVERLAY ================= -->
<div id="mobileOverlay"></div>

<!-- ================= MOBILE SIDEBAR (ONLY MOBILE) ================= -->
<aside id="mobileSidebar" class="mobile-sidebar d-lg-none">
    <div class="sidebar-header">
        <span class="rentify-logo">Rentify</span>
        <span class="close-btn" onclick="closeSidebar()">Ã—</span>
    </div>

    <a class="{% if url_name == 'home' %}active{% endif %}" href="{% url 'home' %}">Home</a>

    {% if not user.is_authenticated %}
        <a class="{% if url_name == 'rent_clothes' %}active{% endif %}" href="{% url 'rent_clothes' %}">Rent Clothes</a>
        <a class="{% if url_name == 'list_clothes' %}active{% endif %}" href="{% url 'list_clothes' %}">List Clothes</a>
        <a href="{% url 'login' %}">Login</a>
        <a href="{% url 'register' %}">Register</a>
    {% elif user.is_buyer %}
        <a class="{% if url_name == 'rent_clothes' %}active{% endif %}" href="{% url 'rent_clothes' %}">Rent Clothes</a>
        <a href="{% url 'buyer_dashboard' %}">My Account</a>
        <a href="{% url 'logout' %}">Logout</a>
    {% elif user.is_seller %}
        <a class="{% if url_name == 'list_clothes' %}active{% endif %}" href="{% url 'list_clothes' %}">List Clothes</a>
        <a href="{% url 'seller_dashboard' %}">My Account</a>
        <a href="{% url 'logout' %}">Logout</a>
    {% endif %}
</aside>

{% endwith %}

{% if messages %}
<div class="rentify-alert-wrapper">
    {% for message in messages %}
        <div class="rentify-alert rentify-alert-{{ message.tags }}">
            <span>{{ message }}</span>
            <button type="button" class="close-alert">&times;</button>
        </div>
    {% endfor %}
</div>
{% endif %}

{% endblock nav %}
<!-- ================= CONTENT ================= -->
<main class="page-wrapper">
    {% block content %}{% endblock %}
</main>

<!-- ================= FOOTER ================= -->
<footer class="rentify-footer">
    <div class="container text-center">
        <p>Â© 2025 Rentify. Style without commitment.</p>
    </div>
</footer>

<script>
function openSidebar() {
    document.getElementById("mobileSidebar").classList.add("show");
    document.getElementById("mobileOverlay").classList.add("show");
    document.body.style.overflow = "hidden";
}

function closeSidebar() {
    document.getElementById("mobileSidebar").classList.remove("show");
    document.getElementById("mobileOverlay").classList.remove("show");
    document.body.style.overflow = "";
}

/* ðŸ”¥ CLOSE SIDEBAR WHEN CLICKING ANYWHERE OUTSIDE */
document.addEventListener("click", function (e) {
    const sidebar = document.getElementById("mobileSidebar");
    const toggle = document.querySelector(".navbar-toggler");

    if (
        sidebar.classList.contains("show") &&
        !sidebar.contains(e.target) &&
        !toggle.contains(e.target)
    ) {
        closeSidebar();
    }
});


document.addEventListener("DOMContentLoaded", function () {
    const alerts = document.querySelectorAll(".rentify-alert");

    alerts.forEach(alert => {
        const closeBtn = alert.querySelector(".close-alert");

        // Manual close
        closeBtn.addEventListener("click", () => {
            alert.remove();
        });

        // Auto close after 3 seconds
        setTimeout(() => {
            if (alert) {
                alert.style.opacity = "0";
                alert.style.transform = "translateY(-10px)";
                setTimeout(() => alert.remove(), 300);
            }
        }, 3000);
    });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
